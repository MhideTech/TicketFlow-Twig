{# templates/pages/tickets/form.twig #}

<!-- Ticket Form Modal -->
<div 
  x-show="showForm"
  x-cloak
  class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
  x-transition
>
  <div 
    class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto"
    @click.away="closeForm()"
  >
    <!-- Header -->
    <div class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between">
      <h2 class="text-xl font-bold text-gray-900" 
          x-text="editingTicket ? 'Edit Ticket' : 'Create New Ticket'"></h2>
      <button 
        @click="closeForm()" 
        class="p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors" 
        aria-label="Close form"
      >
        {{ icon.render('x', 20) }}
      </button>
    </div>

    <!-- Form -->
    <form method="POST" action="/tickets" class="p-6 space-y-6" x-ref="ticketForm">
      <input type="hidden" name="_csrf_token" value="{{ csrf_token }}">
      <input type="hidden" name="id" :value="editingTicket ? editingTicket.id : ''">
      <input type="hidden" name="action" :value="editingTicket ? 'update' : 'create'">
      <!-- Title -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Title <span class="text-red-500">*</span></label>
        <input 
          type="text"
          name="title" 
          x-model="form.title"
          :class="formErrors.title 
            ? 'w-full px-4 py-2 border rounded-lg border-red-500 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow' 
            : 'w-full px-4 py-2 border rounded-lg border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow'"
          placeholder="Enter ticket title"
          aria-invalid="true"
        >
        <p x-show="formErrors.title" class="mt-1 text-sm text-red-600" x-text="formErrors.title"></p>
      </div>

      <!-- Description -->
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
        <textarea 
          rows="4"
          name="description" 
          x-model="form.description"
          :class="formErrors.description 
            ? 'w-full px-4 py-2 border rounded-lg border-red-500 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow' 
            : 'w-full px-4 py-2 border rounded-lg border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow'"
          placeholder="Enter ticket description"
        ></textarea>
        <p x-show="formErrors.description" class="mt-1 text-sm text-red-600" x-text="formErrors.description"></p>
      </div>

      <!-- Status & Priority -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Status -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Status <span class="text-red-500">*</span></label>
          <select 
            x-model="form.status"
            name="status"
            :class="formErrors.status 
              ? 'w-full px-4 py-2 border rounded-lg border-red-500 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow' 
              : 'w-full px-4 py-2 border rounded-lg border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow'"
          >
            <option value="open">Open</option>
            <option value="in_progress">In Progress</option>
            <option value="closed">Closed</option>
          </select>
          <p x-show="formErrors.status" class="mt-1 text-sm text-red-600" x-text="formErrors.status"></p>
        </div>

        <!-- Priority -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
          <select 
            x-model="form.priority"
            name="priority"
            :class="formErrors.priority 
              ? 'w-full px-4 py-2 border rounded-lg border-red-500 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow' 
              : 'w-full px-4 py-2 border rounded-lg border-gray-300 focus:ring-2 focus:ring-green-500 focus:border-transparent transition-shadow'"
          >
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
          <p x-show="formErrors.priority" class="mt-1 text-sm text-red-600" x-text="formErrors.priority"></p>
        </div>
      </div>

      <!-- Actions -->
      <div class="flex justify-end space-x-3">
        <button 
          type="button" 
          @click="closeForm()" 
          class="px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors font-medium"
        >
          Cancel
        </button>
        <button 
          type="submit"
          class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
          :disabled="isSubmitting"
        >
          <span x-text="editingTicket ? 'Update Ticket' : 'Create Ticket'"></span>
        </button>

      </div>
    </form>
  </div>
</div>
